# ADR-0003: Telemetry Ingestion & Aggregation

- **Status:** Accepted
- **Date:** 2025-10-30
- **Owners:** Architecture Team
- **Context:** arc-warmhouse / SmartHome platform

## 1) Context

Платформа обрабатывает телеметрию от IoT-устройств (датчиков и отопительных модулей).  
Каждое устройство периодически отправляет измерения (температура, влажность, мощность, состояние реле и т.п.).  
Требуется надёжно принимать, хранить и агрегировать телеметрию с высокой частотой (до десятков тысяч сообщений в минуту) при минимальной задержке.

Основные сценарии:
- Устройство → брокер MQTT/NATS → сервис Telemetry Ingest.
- Сервис сохраняет измерения в хранилище.
- REST-клиенты (веб/мобильное приложение) запрашивают агрегаты и графики.
- Аналитические сервисы (Automation/Rules) подписываются на события телеметрии.

---

## 2) Decision

### Архитектурная схема

```text
┌──────────────┐        ┌────────────────────┐        ┌────────────────────────┐
│  Device      │  MQTT  │ Telemetry Ingest   │  →→→   │  Storage (TimescaleDB) │
│ (Sensor/MCU) │ ─────► │ (Go microservice)  │        │ + retention & rollups  │
└──────────────┘        └────────────────────┘        └────────────────────────┘
                                          │
                                          ▼
                                  ┌───────────────────┐
                                  │ Telemetry API     │
                                  │ (REST/gRPC)       │
                                  └───────────────────┘